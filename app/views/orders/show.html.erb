<h1 class="mb-4">Detalhes do Pedido <%= @order.code %></h1>

<% if owner_signed_in? %>
  <% if @same_day_orders.any? %>
    <div class="alert alert-warning" role="alert">
      Atenção: Há mais <%= @same_day_orders.count %> <%= Order.model_name.human(count: @same_day_orders).downcase %>
                       <%= t(:scheduled, count: @same_day_orders.count) %> para o mesmo dia!
      <% @same_day_orders.each do |order| %>
        <p>Pedido: <%= link_to order.code, order %></p>
      <% end %>
    </div>
  <% end %>
<% end %>

<section id="order_details">
  <dl class="row">
    <dd class="col-sm-3"><strong>Cliente:</strong></dd>
    <dt class="col-sm-9"><%= @order.client.name %></dt>
    <dd class="col-sm-3"><strong>Evento:</strong></dd>
    <dt class="col-sm-9"><%= @order.event_type.name %></dt>
    <dd class="col-sm-3"><strong>Data:</strong></dd>
    <dt class="col-sm-9"><%= I18n.localize(@order.event_date.to_date) %></dt>
    <dd class="col-sm-3"><strong>Endereço:</strong></dd>
    <dt class="col-sm-9">
      <% if @order.event_type.location_option %>
        <%= @order.event_address %>
      <% else %>
        <%= @order.event_type.buffet.full_address %>
      <% end %>
    </dt>
    <dd class="col-sm-3"><strong>Informações Adicionais:</strong></dd>
    <dt class="col-sm-9"><%= @order.event_details %></dt>
    <dd class="col-sm-3"><strong>Status:</strong></dd>
    <dt class="col-sm-9"><%= I18n.translate(@order.status) %></dt>
    <dd class="col-sm-3">
      <% if @order.pending? %>
        <strong>Valor Provisório:</strong>
      <% else %>
        <strong>Valor Final:</strong>
      <% end %>
    </dd>
    <dt class="col-sm-9">R$<%= @order.final_price %></dt>

    <% if @order.approved? %>
      <dd class="col-sm-3"><strong>Data de Validade:</strong></dd>
      <dt class="col-sm-9"><%= I18n.localize(@order.price_valid_until.to_date) %></dt>
      <dd class="col-sm-3"><strong>Taxa Extra:</strong></dd>
      <dt class="col-sm-9">R$<%= @order.extra_fee %></dt>
      <dd class="col-sm-3"><strong>Desconto:</strong></dd>
      <dt class="col-sm-9">R$<%= @order.discount %></dt>
      <dd class="col-sm-3"><strong>Detalhes do Ajuste:</strong></dd>
      <dt class="col-sm-9"><%= @order.adjustment_description %></dt>
      <dd class="col-sm-3"><strong>Método de Pagamento:</strong></dd>
      <dt class="col-sm-9"><%= @order.payment_method.name %></dt>      
    <% end %>
  </dl>
</section>

<% if client_signed_in? && @order.pending? %>
  <%= link_to 'Editar Pedido', edit_order_path(@order.id) %>
<% end %>

<section id="evaluate_order">
  <% if owner_signed_in? && @order.pending? %>
    <h2>Avaliar Pedido</h2>
    <%= Order.human_attribute_name(:final_price)%>: R$<%= @order.final_price %>
    <%= form_with model: @order, url: approved_order_path(@order.id) do |f| %>
      <div>
        <%= f.label :price_valid_until %>
        <%= f.date_field :price_valid_until %>
      </div>
      <div>
        <%= f.label :extra_fee %>
        <%= f.number_field :extra_fee %>
      </div>
      <div>
        <%= f.label :discount %>
        <%= f.number_field :discount %>
      </div>
      <div>
        <%= f.label :adjustment_description %>
        <%= f.text_field :adjustment_description %>
      </div>
      <div>
        <%= f.label :payment_method_id %>
        <%= f.collection_select :payment_method_id, @payment_methods, :id, :name %>
      </div>
      <%= f.submit 'Aprovar Pedido' %>
    <% end %>

    <%= button_to 'Cancelar Pedido', canceled_order_path(@order.id) %>
  <% end %>
</section>

<%= link_to 'Voltar', root_path %>